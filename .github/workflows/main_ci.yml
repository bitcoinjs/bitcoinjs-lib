const bitcoin = require('bitcoinjs-lib');

// Raw transaction hex
const rawTx = '02000000000107f9cfddb9b7fd8ed4570e09975378529d776f97028b57f912dae1800952b3ba387000000000fdffffff5a3f806fe22dda397777f3397e666ca90c08f74803604fa909cc3ebb7ecaf06b0100000000fdffffff72098d3a51b99068bda6ee8c058857b4cc5884b1d38f5d4221b66ba3007cf89a6300000000fdffffffb54859507676f54bef882848c080ad794f68af33a89d24520b3a5721399947d7db00000000fdffffff6e80296c15737b482e38f637eff6dc4b9bf2de764e74c0c437d33bf21a09b9d85500000000fdffffff7bfe6e58e51bffb1a621dbe3e31f824575aa8ac670ab866d3a9c4a3b517b6bdc0100000000fdffffff0a8a65b5c2e68890301473bd0cc455d082fb71c054ffe8596b19864ed0bc6ee6e708000000fdffffff02a02526000000000016001498d828c0ac2f7f4d8ff0e453ee8cc1ac4e2760126106189f030000001976a914f5edbaa8ddfa2d956e375b52eb74040d8a7ba25a88ac0247304402207d5428171ace552f634cb7971e3c5ab69d1930202884230608d56051c851c935022044409ac83b89c4532b2e9313273c6423ab87ed68eaf3431924cd20c898f490640121029b04603dfaafc97fb89697439ee752993e0688d897845720d28ca79d98ca600302473044022070ca345d58b52ed332f596a5abc15eddcb4d8fbc255d52c4334b0d6b050bf1370220484083000f7b7491982f502ae5feafdeb8a611c9a7a774d5ec147286d2a48b3d0121029b04603dfaafc97fb89697439ee752993e0688d897845720d28ca79d98ca60030247304402200c63d0ca0f3b35f1d944b6147a7ab30b236d67f8bae218c096446ec74d4b77e802203dd23a4da3f41f596344d0d386c81c6db9adf0844acde1bfe010a4e1f3a521860121029b04603dfaafc97fb89697439ee752993e0688d897845720d28ca79d98ca600302473044022029b2424202f0b5242de4267e33114799f7875e65d1f846f09f12c5318f679c11022048b4b731d4a9195f6c55fd86618cfe0c823fb01170344b965bd9e53aaf39202e0121029b04603dfaafc97fb89697439ee752993e0688d897845720d28ca79d98ca60030247304402203c6dee089dff179d46a4873e5a8c590ed8340f8389047d63ea934a153e7a66ac02200699ee45e5541c00aead9aacdc194a670d1435afc69646ca93bd03cfa734ec3d0121029b04603dfaafc97fb89697439ee752993e0688d897845720d28ca79d98ca600302473044022023ac7cfa77f37f44d81b2e7437eca667929cce176790b902bb543319fc63bb78022071561c9d7a80e1e21adbe1eb0de5394a24cf7ef1d02c20827a228236a84fbf550121029b04603dfaafc97fb89697439ee752993e0688d897845720d28ca79d98ca60030247304402200662487267e9792883791b80831066b6e23a1d60c2f722dc17e81d12f8f68cea022058717a1cc14a48f6c8d90bb1badcbabc81cd0bb21c9d29231d683f752bd79c980121029b04603dfaafc97fb89697439ee752993e0688d897845720d28ca79d98ca60030a910d00';

// Decode the raw transaction
const tx = bitcoin.Transaction.fromHex(rawTx);
console.log(tx);

// To get more readable information
const txDetails = {
  txid: tx.getId(),
  version: tx.version,
  locktime: tx.locktime,
  inputs: tx.ins.map(input => ({
    txid: Buffer.from(input.hash).reverse().toString('hex'),
    index: input.index,
    script: bitcoin.script.toASM(input.script),
    sequence: input.sequence
  })),
  outputs: tx.outs.map(output => ({
    value: output.value,
    script: bitcoin.script.toASM(output.script)
  }))
};

console.log(txDetails);name: Run Tests

on:
  push:
    branches:
      - master
  pull_request:

permissions:
  contents: read
  pages: write
  id-token: write


jobs:
  ##################
  # Jobs with matrix
  ##################
  unit:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        node-version: [18, 'lts/*']
        # See supported Node.js release schedule at https://nodejs.org/en/about/releases/
    steps:
      - uses: actions/checkout@ec3a7ce113134d7a93b817d10a8272cb61118579 # v2
      - name: Use Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@eeb10cff27034e7acf239c5d29f62154018672fd # v3
        with:
          node-version: ${{ matrix.node-version }}
          registry-url: https://registry.npmjs.org/
          cache: 'npm'
      - run: npm ci
      - run: npm run unit
  integration:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        node-version: [18, 'lts/*']
        # See supported Node.js release schedule at https://nodejs.org/en/about/releases/
    services:
      regtest:
        image: junderw/bitcoinjs-regtest-server@sha256:5b69cf95d9edf6d5b3a00504665d6b3c382a6aa3728fe8ce897974c519061463
        ports:
          - 8080:8080
    steps:
      - uses: actions/checkout@ec3a7ce113134d7a93b817d10a8272cb61118579 # v2
      - name: Use Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@eeb10cff27034e7acf239c5d29f62154018672fd # v3
        with:
          node-version: ${{ matrix.node-version }}
          registry-url: https://registry.npmjs.org/
          cache: 'npm'
      - run: npm ci
      - run: APIURL=http://127.0.0.1:8080/1 npm run integration



  #####################
  # Jobs without matrix
  #####################
  coverage:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@ec3a7ce113134d7a93b817d10a8272cb61118579 # v2
      - uses: actions/setup-node@eeb10cff27034e7acf239c5d29f62154018672fd # v3
        with:
          node-version: 'lts/*'
          registry-url: https://registry.npmjs.org/
          cache: 'npm'
      - run: npm ci
      - run: npm run coverage
  format:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@ec3a7ce113134d7a93b817d10a8272cb61118579 # v2
      - uses: actions/setup-node@eeb10cff27034e7acf239c5d29f62154018672fd # v3
        with:
          node-version: 'lts/*'
          registry-url: https://registry.npmjs.org/
          cache: 'npm'
      - run: npm ci
      - run: npm run format:ci
  gitdiff:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@ec3a7ce113134d7a93b817d10a8272cb61118579 # v2
      - uses: actions/setup-node@eeb10cff27034e7acf239c5d29f62154018672fd # v3
        with:
          node-version: 'lts/*'
          registry-url: https://registry.npmjs.org/
          cache: 'npm'
      - run: npm ci
      - run: npm run gitdiff:ci
  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@ec3a7ce113134d7a93b817d10a8272cb61118579 # v2
      - uses: actions/setup-node@eeb10cff27034e7acf239c5d29f62154018672fd # v3
        with:
          node-version: 'lts/*'
          registry-url: https://registry.npmjs.org/
          cache: 'npm'
      - run: npm ci
      - run: npm run lint
  lint-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@ec3a7ce113134d7a93b817d10a8272cb61118579 # v2
      - uses: actions/setup-node@eeb10cff27034e7acf239c5d29f62154018672fd # v3
        with:
          node-version: 'lts/*'
          registry-url: https://registry.npmjs.org/
          cache: 'npm'
      - run: npm ci
      - run: npm run lint:tests

  build-doc:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@ec3a7ce113134d7a93b817d10a8272cb61118579 # v2
      - uses: actions/setup-node@eeb10cff27034e7acf239c5d29f62154018672fd # v3
        with:
          node-version: 'lts/*'
          registry-url: https://registry.npmjs.org/
          cache: 'npm'
      - run: npm ci
      - run: npm run doc
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          path: ./docs

  deploy-doc:
    if: github.ref == 'refs/heads/master'
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build-doc
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v2
